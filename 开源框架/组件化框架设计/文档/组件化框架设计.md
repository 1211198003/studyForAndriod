# 组件化框架设计

“听的再多，不如实现一下”

## 什么是组件化，为什么需要组件化？

组件化的意义：不相互依赖，可以相互交互，任意组合，高度解耦，自由拆卸，自由组装，重复利用，分层独立化

![image-20241007151140699](/Users/limiaoxuan/Library/Application Support/typora-user-images/image-20241007151140699.png)

### 案例实操

​        项目中有四个子模块，ktv，home，mall，live 模块，它们既可以独立运行，又可以作为模块被 app 引入使用

​	有两个共有组件库，common，base，会被所有模块引入

<img src="/Users/limiaoxuan/Library/Application Support/typora-user-images/image-20241007162122600.png" alt="image-20241007162122600" style="zoom:30%;" />

#### (1) settings.gradle 的引入

将上述包进行引入，方便 gradle 进行编译

```groovy
rootProject.name = "ComponentsDesign"
include ':app'
include ':common'
include ':mall'
include ':ktv'
include ':home'
include ':base'
```

#### (2) 将 build.gradle 进行改造，统一版本管理

首先在引入网络依赖方面 ：

##### **buildResp/element.gradle** 

```groovy
ext {
    control_lib = [
            [
                    name: "appcompat",
                    groupId: "androidx.appcompat",
                    groupName: "appcompat",
                    version: "1.7.0",
                    declare : "implementation"
            ],
            [
                    name: "androidx-activity-compose",
                    groupId: "androidx.activity",
                    groupName: "activity-compose",
                    version: "1.9.2",
                    declare : "implementation"
            ],
            [
                    name: "junit",
                    groupId: "junit",
                    groupName: "junit",
                    version: "4.13.2",
                    declare : "implementation"
            ]
    ]
}
// 将上述的 control_lib 按照 name: lib的hash形式存在 hashmap 中
ext.set("globalDependenciesMap", new HashMap<String, HashMap<String, String>>())
control_lib.each { lib ->
    def d = ext
    ext.globalDependenciesMap[lib.name] =  lib
}
println("globalDependenciesMap"+ globalDependenciesMap)
println("element.gradle")

```

文件以名字为标记，在不同模块引入依赖

##### **buildResp/dependency.gradle** 	

- dep 里面写的是网络包的
  - 若是写在 project 下，那么 会在所有的子项目中都引入对应的包
  - 剩下的就是对应的子模块，包括 App 模块各自的引入

- localDep 里面写的是项目模块依赖导入

```groovy

ext {
    dep = [
        project: [
            "appcompat",
            "androidx-activity-compose",
            "junit"
        ],
        app: [

        ],
        mall: [

        ],
        ktv: [

        ],
        home: [

        ],
        common: [

        ],
        base:[

        ]
    ]
    localDep = [
        app: [
            "mall",
            "ktv",
            "home",
            "base",
            "common"
        ],
        mall: [
            "base",
            "common"
        ],
        ktv: [
            "base",
            "common"
        ],
        home: [
            "base",
            "common"
        ],
        common: [

        ],
        base:[

        ]
    ]

}
```

##### buildResp/config.gradle

​	书写全局变量配置属性

##### element.gradle

​	统一版本信息配置

​	





